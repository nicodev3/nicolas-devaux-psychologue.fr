---
import Doctolib from "./Doctolib.astro";
import { getCollection } from "astro:content";
import FormattedDate from "./FormattedDate.astro";

// Ajout de la prop
interface Props {
  showPsyInfo?: boolean;
}

const { showPsyInfo = true } = Astro.props;

const posts = (await getCollection("blog")).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
---

<aside
  class="xl:w-1/3 flex flex-col space-y-8"
>
  <Doctolib />
  
  <!-- Section Articles -->
  <div class="bg-white rounded-xl shadow-md p-8 border border-gray-100">
    <h3 class="text-xl font-bold text-tertiary mb-6">Derniers articles</h3>
    <ul class="space-y-4">
      {
        posts.map((post) => (
          <li class="border-b border-gray-100 pb-4 last:border-b-0 last:pb-0">
            <a href={`/blog/${post.slug}/`} class="block group">
              <h4 class="text-sm font-medium text-gray-700 group-hover:text-accent transition-colors duration-200 leading-relaxed mb-1">
                {post.data.title}
              </h4>
              <p class="text-xs text-gray-500">
                <FormattedDate date={post.data.pubDate} />
              </p>
            </a>
          </li>
        ))
      }
    </ul>
  </div>

  {
    showPsyInfo && (
      <div class="bg-white rounded-xl shadow-md p-8 border border-gray-100">
        <h3 class="text-xl font-bold text-tertiary mb-4">Profession réglementée</h3>
        
        <div class="space-y-4 text-sm text-gray-700 leading-relaxed">
          <p>
            En France, la profession de <strong class="text-tertiary">psychologue</strong>
            est réglementée par le ministère de l'Enseignement supérieur, de la Recherche et de l'Innovation.
          </p>
          <p>
            L'obtention du titre requiert une licence et un master en psychologie, incluant un mémoire
            de recherche et un stage professionnel. Le numéro RPPS permet d'identifier les professionnels de santé.
          </p>
          <p>
            Le psychologue respecte un code de déontologie garantissant des pratiques éthiques, 
            la confidentialité des échanges et la protection des patients.
          </p>
        </div>
      </div>
    )
  }
</aside>
